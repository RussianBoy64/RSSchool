(()=>{"use strict";function e(e){return null!==e&&`${Math.floor(e/60).toString().padStart(2,"0")}:${(e%60).toString().padStart(2,"0")}`}class t{constructor(){this.currentGameState={solvedState:null,currentState:null,moves:0,seconds:0,frameSize:4,isChanged:!1},this.savedGameState=null,this.isGameStarted=!1,this.timer=null,this.isSound=!0,this.results=[{position:1,name:"Vladimir",moves:15,seconds:123},{position:2,name:"Semen",moves:19,seconds:131},{position:3,name:"Arkadiy",moves:21,seconds:142},{position:4,name:"Vika",moves:23,seconds:145},{position:5,name:"Vitaliy",moves:29,seconds:232},{position:6,name:null,moves:null,seconds:null},{position:7,name:null,moves:null,seconds:null},{position:8,name:null,moves:null,seconds:null},{position:9,name:null,moves:null,seconds:null},{position:10,name:null,moves:null,seconds:null}]}setFrameSize(){const e=document.querySelector('.settings__input[name="frame-size"]:checked').value;this.currentGameState.frameSize=e}shuffle=e=>{e.preventDefault(),this.stopGame(),this.setFrameSize();const t=document.querySelector(".backdrop"),s=document.querySelector(".settings"),a=document.querySelector(".settings__btn");a.classList.contains("active")&&(a.classList.remove("active"),s.classList.remove("show"),t.classList.remove("show"));const n=[],r=this.currentGameState.frameSize**2;for(let e=1;e<=r;e++)e===r?n.push(null):n.push(e);const i=function(e){const t=[].concat(e);for(let e=t.length-1;e>0;e--){let s=Math.floor(Math.random()*(e+1)),a=t[s];t[s]=t[e],t[e]=a}const s=function(e){const t=[].concat(e);let s=0,a=t.indexOf(null),n=Math.sqrt(t.length)-Math.floor(a/Math.sqrt(t.length));if(t.forEach(((e,t,a)=>{if(null!==e){let n=0;for(let r=t+1;r<a.length;r++)e>a[r]&&null!==a[r]&&(s++,n++)}})),t.length%2!=0&&s%2==0||t.length%2==0&&(n%2!=0&&s%2==0||n%2==0&&s%2!=0))return t;{let e=null;return null!==t[0]&&null!==t[1]?(e=t[1],t[1]=t[0],t[0]=e):(e=t[t.length-1],t[t.length-1]=t[t.length-2],t[t.length-2]=e),t}}(t);return s}(n);this.currentGameState.solvedState=n,this.currentGameState.currentState=i;const c=document.querySelector(".start__btn");this.renderGameBoard(),c.disabled&&c.removeAttribute("disabled")};renderGameBoard=()=>{const e=document.querySelector(".gameboard__gamefield");!1===this.isGameStarted&&e.classList.contains("show")&&e.classList.remove("show"),e.innerHTML="",this.currentGameState.currentState.forEach((t=>{const s=document.createElement("div"),a=100/this.currentGameState.frameSize+"%";s.classList.add("gamefield__tile"),null===t?(s.classList.add("empty"),s.textContent=""):s.textContent=t,s.style.width=a,s.style.height=a,e.append(s)})),!1===this.isGameStarted&&setTimeout((()=>{e.classList.add("show")}),0)};startGame=()=>{if(!1===this.isGameStarted){const e=document.querySelector(".start__btn"),t=document.querySelector(".save__btn");this.isGameStarted=!0,e.disabled=!0,t.disabled=!1,this.timer=setInterval(this.updateTime,1e3)}};stopGame=()=>{if(!0===this.isGameStarted){const t=document.querySelector(".stats__moves"),s=document.querySelector(".stats__time");this.isGameStarted=!1,this.currentGameState.moves=0,t.innerHTML="00",clearInterval(this.timer),this.currentGameState.seconds=0,s.textContent=e(this.currentGameState.seconds)}};saveGame=()=>{const e=document.querySelector(".load__btn"),t=JSON.stringify(this.currentGameState);this.savedGameState=JSON.parse(t),e.disabled=!1,localStorage.setItem("savedGameState",t)};saveGameData=()=>{localStorage.setItem("isSound",JSON.stringify(this.isSound)),localStorage.setItem("results",JSON.stringify(this.results))};loadGame=async()=>{const t=document.querySelector(".start__btn"),s=document.querySelector(".stats__moves"),a=document.querySelector(".stats__time"),n=JSON.parse(localStorage.getItem("savedGameState"));t.disabled=!1,this.isGameStarted=!1,this.currentGameState=n,this.renderGameBoard(),clearInterval(this.timer),s.innerHTML=String(this.currentGameState.moves).padStart(2,0),a.innerHTML=e(this.currentGameState.seconds)};updateTime=()=>{const t=document.querySelector(".stats__time");this.currentGameState.seconds++,t.innerHTML=e(this.currentGameState.seconds)};updateMoves=()=>{const e=document.querySelector(".stats__moves");this.currentGameState.moves++,e.innerHTML=String(this.currentGameState.moves).padStart(2,0)};boardClickHandler=e=>{const t=e.currentTarget;if(t.classList.contains("show")){const s=e.target,a=this.currentGameState.currentState.indexOf(null),n=a%this.currentGameState.frameSize!=this.currentGameState.frameSize-1,r=a%this.currentGameState.frameSize!=0,i=t.children[a].nextSibling===s,c=t.children[a].previousSibling===s,o=t.children[a-this.currentGameState.frameSize]===s,d=t.children[a+Number(this.currentGameState.frameSize)]===s,l=document.querySelector(".moveSound");this.startGame(),n&&i?(s.classList.add("moveLeft"),this.isSound&&l.play(),t.removeEventListener("click",this.boardClickHandler),t.addEventListener("animationend",this.changeGameState)):r&&c?(s.classList.add("moveRight"),this.isSound&&l.play(),t.removeEventListener("click",this.boardClickHandler),t.addEventListener("animationend",this.changeGameState)):o?(s.classList.add("moveDown"),this.isSound&&l.play(),t.removeEventListener("click",this.boardClickHandler),t.addEventListener("animationend",this.changeGameState)):d&&(s.classList.add("moveTop"),this.isSound&&l.play(),t.removeEventListener("click",this.boardClickHandler),t.addEventListener("animationend",this.changeGameState))}};changeGameState=e=>{const t=e.target,s=e.currentTarget,a=this.currentGameState.currentState.indexOf(+t.innerText),n=this.currentGameState.currentState.indexOf(null),r=this.currentGameState.currentState[a];this.currentGameState.currentState[a]=this.currentGameState.currentState[n],this.currentGameState.currentState[n]=r,this.renderGameBoard(),this.updateMoves(),t.className="gamefield__tile",s.addEventListener("click",this.boardClickHandler),this.isSolved()&&(s.classList.remove("show"),alert("you solved it"))};soundHandler=e=>{const t=e.target;this.isSound=t.checked};isSolved=()=>{const e=this.currentGameState.solvedState.join(" ")===this.currentGameState.currentState.join(" ");return e&&this.isSound&&document.querySelector(".victorySound").play(),e}}class s{constructor(){this.wrapper=null}createPopUpWrapper=async()=>{const e=document.createElement("div");return e.classList.add("popUp"),this.wrapper=e,e};renderResults=async()=>{const t=document.createElement("div"),s=document.createElement("h3");this.wrapper.innerHTML="",t.classList.add("results"),s.classList.add("results__title"),s.textContent="Top 10",t.append(s),o.results.forEach((s=>{const a=document.createElement("div");a.classList.add("row");const n=document.createElement("span");n.classList.add("position"),n.textContent=`${s.position}.`;const r=document.createElement("span");r.classList.add("name"),r.textContent=`${s.name||"..."}`;const i=document.createElement("span");i.classList.add("moves"),i.textContent=`M: ${s.moves||"00"}`;const c=document.createElement("span");c.classList.add("time"),c.textContent=`T: ${e(s.seconds)||"00:00"}`,a.append(n),a.append(r),a.append(i),a.append(c),t.append(a)})),this.wrapper.append(t),l.backdropShow(),setTimeout((()=>{this.wrapper.classList.add("show")}),0)};popUpHide=()=>{this.wrapper.classList.remove("show")}}class a{constructor(){this.backdrop=null}createBackdrop=async()=>{const e=document.createElement("div");return e.classList.add("backdrop"),e.addEventListener("click",this.backdropHide),this.backdrop=e,e};backdropToggle=()=>{this.backdrop.classList.toggle("show")};backdropShow=()=>{this.backdrop.classList.add("show")};backdropHide=()=>{this.backdrop.classList.remove("show"),m.settingsMenuHide(),d.popUpHide()}}async function n(e="",t="",s=!1){const a=document.createElement("button");return a.classList.add("btn"),a.classList.add(e),a.textContent=t,a.disabled=s,a}const r=[{size:"3x3",value:3},{size:"4x4",value:4},{size:"5x5",value:5},{size:"6x6",value:6},{size:"7x7",value:7},{size:"8x8",value:8}];class i{constructor(){this.settings=null,this.settingsBtn=null}renderSettings=async()=>{const e=document.createElement("div"),t=document.querySelector(".settings__btn");e.classList.add("settings");const s=document.createElement("form"),a=document.createElement("span"),i=await n("shuffle__btn","Shuffle");s.classList.add("settings__form"),s.action="/",a.classList.add("settings__title"),a.textContent="Frame size:",s.append(a),r.forEach((e=>{const t=document.createElement("input"),a=document.createElement("label");t.classList.add("settings__input"),t.id=e.size,t.type="radio",t.name="frame-size",t.value=e.value,e.value===o.currentGameState.frameSize&&(t.checked=!0),a.classList.add("settings__label"),a.htmlFor=e.size,a.textContent=e.size,s.append(t),s.append(a)})),s.append(i);const c=document.createElement("input"),d=document.createElement("label");return c.classList.add("sound__input"),c.id="switch",c.type="checkbox",c.name="sound",c.checked=o.isSound,d.classList.add("sound__label"),d.htmlFor="switch",d.textContent="Sound",e.append(s),e.append(c),e.append(d),t.addEventListener("click",this.settingsMenuToggle),i.addEventListener("click",o.shuffle),c.addEventListener("change",o.soundHandler),this.settings=e,this.settingsBtn=t,e};settingsMenuToggle=()=>{this.settingsBtn.classList.toggle("active"),this.settings.classList.toggle("show"),d.wrapper.classList.contains("show")?d.wrapper.classList.remove("show"):l.backdropToggle()};settingsMenuHide=()=>{this.settingsBtn.classList.remove("active"),this.settings.classList.remove("show")}}function c(){const e=document.createElement("div");return e.classList.add("wrapper"),e}let o=null,d=null,l=null,m=null;const u=document.querySelector(".app");document.addEventListener("DOMContentLoaded",(async function(){o=await async function(){const e=new t,s=JSON.parse(localStorage.getItem("savedGameState")),a=localStorage.getItem("isSound"),n=JSON.parse(localStorage.getItem("results"));return s&&(e.savedGameState=s),a&&(e.isSound=JSON.parse(a)),n&&(e.results=n),e}(),d=new s,l=new a,m=new i;const e=await async function(){const e=document.createElement("header");e.classList.add("header");const t=c(),s=document.createElement("div");s.classList.add("header__inner");const a=document.createElement("div"),n=document.createElement("img"),r=document.createElement("h1");a.classList.add("header__logo"),n.src="./assets/logo.png",n.alt="app logo",r.textContent="Gem-puzzle";const i=document.createElement("i");return i.classList.add("fa-solid"),i.classList.add("fa-gear"),i.classList.add("settings__btn"),a.append(n),a.append(r),s.append(a),s.append(i),t.append(s),e.append(t),e}();u.append(e);const r=await async function(){const e=document.createElement("main");e.classList.add("main");const t=c();t.classList.add("gameboard");const s=document.createElement("div"),a=await n("shuffle__btn","Shuffle"),r=await n("start__btn","Start",!o.currentGameState.currentState),i=await n("results__btn","Results"),l=await n("save__btn","Save",!o.currentGameState.currentState),u=await n("load__btn","Load",!o.savedGameState);s.classList.add("gameboard__controls"),s.append(a),s.append(r),s.append(i),s.append(l),s.append(u);const p=await async function(){const e=document.createElement("span");return e.classList.add("gameboard__stats"),e.innerHTML='\n  <span>\n      <span class="stats__name">Moves:</span>\n      <span class="stats__moves">00</span>\n  </span>\n  <span>\n      <span class="span stats__name">Time:</span>\n      <span class="stats__time">\n        00: 00\n      </span>\n  </span>\n  ',e}(),h=document.createElement("div");h.classList.add("gameboard__gamefield");const S=await m.renderSettings(),v=document.createElement("audio"),g=document.createElement("source");v.classList.add("moveSound"),g.src="./assets/moveTile.mp3",g.type="audio/mpeg",v.append(g);const L=document.createElement("audio"),_=document.createElement("source");return L.classList.add("victorySound"),_.src="./assets/victory.mp3",_.type="audio/mpeg",L.append(_),t.append(s),t.append(p),t.append(h),e.append(t),e.append(S),e.append(v),e.append(L),a.addEventListener("click",o.shuffle),r.addEventListener("click",o.startGame),i.addEventListener("click",d.renderResults),l.addEventListener("click",o.saveGame),u.addEventListener("click",o.loadGame),h.addEventListener("click",o.boardClickHandler),e}();u.append(r);const p=await async function(){const e=document.createElement("footer");e.classList.add("footer");const t=c(),s=document.createElement("div");s.classList.add("author-info");const a=document.createElement("div"),n=document.createElement("a"),r=document.createElement("img");a.classList.add("author-info__item"),n.href="https://rs.school/js/",r.src="https://rs.school/images/rs_school_js.svg",r.alt="RS School",n.append(r),a.append(n);const i=document.createElement("div"),o=document.createElement("span");i.classList.add("author-info__item"),o.textContent="2022",i.append(o);const d=document.createElement("div"),l=document.createElement("div"),m=document.createElement("a"),u=document.createElement("i");return d.classList.add("author-info__item"),l.classList.add("github-link"),m.href="https://github.com/RussianBoy64",m.textContent="RussianBoy64",u.classList.add("fa-brands"),u.classList.add("fa-github"),u.classList.add("github-icon"),m.prepend(u),l.append(m),d.append(l),s.append(a),s.append(i),s.append(d),t.append(s),e.append(t),e}();u.append(p);const h=await l.createBackdrop();u.append(h);const S=await d.createPopUpWrapper();u.append(S),window.addEventListener("beforeunload",o.saveGameData)}))})();